<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Mini Horizon Chase – Chevrolet Corsa (Manual Total)</title>
  <style>
    body { margin:0; overflow:hidden; background: linear-gradient(#071029,#0f1724); font-family: Arial, sans-serif; }
    #score { position:absolute; top:18px; left:18px; z-index:30; color:#fff; font-weight:800; font-size:20px; text-shadow:0 2px 6px #000; }
    #hud { position:absolute; right:18px; top:18px; z-index:30; color:#fff; text-align:right; }
    #gameOverScreen { position:absolute; inset:0; display:none; align-items:center; justify-content:center; background:rgba(0,0,0,0.85); color:#fff; flex-direction:column; gap:12px; font-size:20px; z-index:50; }
    #gameOverScreen h1 { font-size:48px; margin:0; color:#ff3333; text-shadow:0 2px 8px #000; }
    #gameOverScreen button { padding:10px 18px; font-size:18px; border-radius:8px; border:0; background:#ff3333; color:#fff; cursor:pointer; }
  </style>
</head>
<body>
  <div id="score">Pontos: 0</div>
  <div id="hud">
    <div id="time">Tempo: 0s</div>
    <div id="level">Nível: 1</div>
  </div>

  <div id="gameOverScreen">
    <h1>GAME OVER</h1>
    <p id="finalScore">Pontuação: 0</p>
    <div style="display:flex;gap:12px">
      <button id="btnRestart">Reiniciar</button>
      <button id="btnScores">Ver Pontuações</button>
    </div>
    <div id="scoreHistory"></div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/three@0.157.0/build/three.min.js"></script>
  <script>
    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(60, window.innerWidth/window.innerHeight, 0.1, 1000);
    camera.position.set(0, 15, 25);
    const renderer = new THREE.WebGLRenderer({antialias:true});
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.body.appendChild(renderer.domElement);

    const hemi = new THREE.HemisphereLight(0xffffbb, 0x080820, 1.0); scene.add(hemi);
    const dir = new THREE.DirectionalLight(0xffffff, 0.6); dir.position.set(5,20,10); scene.add(dir);

    const ROAD_W = 12;
    const roadGeo = new THREE.PlaneGeometry(ROAD_W, 400, 1, 40);
    const roadMat = new THREE.MeshPhongMaterial({ color:0x222222 });
    const road = new THREE.Mesh(roadGeo, roadMat); road.rotation.x = -Math.PI/2; road.position.z = -120; scene.add(road);

    const stripes = [];
    function createStripe(z){ const g = new THREE.PlaneGeometry(0.2, 4); const m = new THREE.MeshBasicMaterial({ color:0xffffff }); const s = new THREE.Mesh(g,m); s.rotation.x=-Math.PI/2; s.position.set(0,0.02,z); scene.add(s); stripes.push(s); }
    for(let i=0;i<200;i+=5) createStripe(-i);

    const lamps = [], buildings = [];
    function createLamp(x,z){ const post = new THREE.Mesh(new THREE.CylinderGeometry(0.08,0.1,4), new THREE.MeshPhongMaterial({ color:0xaaaaaa })); post.position.set(x,2,z); const bulb = new THREE.Mesh(new THREE.SphereGeometry(0.25,8,8), new THREE.MeshPhongMaterial({ color:0xffffaa, emissive:0xffff33 })); bulb.position.set(0,1.9,0); post.add(bulb); scene.add(post); lamps.push(post); }
    for(let i=0;i<40;i++){ createLamp(-ROAD_W/2 - 2, -i*8 - 6); createLamp(ROAD_W/2 + 2, -i*8 - 2); }
    function createBuilding(z){ const w=3+Math.random()*6; const h=6+Math.random()*20; const d=3+Math.random()*6; const mat=new THREE.MeshPhongMaterial({ color:Math.random()*0xffffff }); const b=new THREE.Mesh(new THREE.BoxGeometry(w,h,d), mat); const side=Math.random()<0.5?-1:1; const x=side*(ROAD_W/2 + 6 + Math.random()*12); b.position.set(x,h/2,z); scene.add(b); buildings.push(b); }
    for(let i=0;i<60;i++) createBuilding(-i*12 - 20);

    const player = new THREE.Group();
    const body = new THREE.Mesh(new THREE.BoxGeometry(2.4,0.6,4.2), new THREE.MeshPhongMaterial({ color:0x3366cc })); body.position.y=0.6; player.add(body);
    const cabin = new THREE.Mesh(new THREE.BoxGeometry(1.8,0.8,2.2), new THREE.MeshPhongMaterial({ color:0x111111, transparent:true, opacity:0.75 })); cabin.position.y=1; player.add(cabin);
    player.position.set(0,0,5); scene.add(player);

    const npcs=[];
    function spawnNpc(z){ const g=new THREE.Group(); const col=new THREE.MeshPhongMaterial({ color: Math.random()*0xffffff }); const b=new THREE.Mesh(new THREE.BoxGeometry(2.0,0.6,3.2), col); b.position.y=0.5; g.add(b); const lane = Math.floor(Math.random()*3); const laneX = (lane-1)*(ROAD_W/3); g.userData = { lane, z: z || -200 - Math.random()*200, type: Math.random()<0.3?'oil':'npc', passed:false }; g.position.set(laneX,0,g.userData.z); scene.add(g); npcs.push(g); }
    for(let i=0;i<6;i++) spawnNpc(-i*40-60);

    let running=true, score=0, startTime=performance.now(), level=1, speed=0, maxSpeed=600/3.6;

    const scoreEl=document.getElementById('score');
    const timeEl=document.getElementById('time');
    const levelEl=document.getElementById('level');
    const gameOverScreen=document.getElementById('gameOverScreen');
    const finalScore=document.getElementById('finalScore');

    let slipTimer=0;
    let keys = {};
    document.addEventListener('keydown', e => keys[e.key] = true);
    document.addEventListener('keyup', e => keys[e.key] = false);

    const clock=new THREE.Clock();
    function animate(){ if(!running) return; requestAnimationFrame(animate); const dt=clock.getDelta(); update(dt); renderer.render(scene,camera); }

    function update(dt){
      // Aceleração gradual e mais rápida para frente
      if(keys['ArrowUp']) speed += 150*dt; else speed -= 50*dt;
      speed = Math.max(0, Math.min(maxSpeed, speed));
      const worldMove = speed*dt;

      for(const s of stripes){ s.position.z += worldMove; if(s.position.z>40) s.position.z-=600; }
      for(const l of lamps){ l.position.z += worldMove; if(l.position.z>40) l.position.z-=600; }
      for(const b of buildings){ b.position.z += worldMove; if(b.position.z>60) b.position.z-=1200; }
      road.position.z += worldMove; if(road.position.z>40) road.position.z-=800;

      // Movimento lateral livre do jogador
      const limit = ROAD_W/2-1.2;
      if(keys['ArrowLeft']) player.position.x -= 0.8*dt*60;
      if(keys['ArrowRight']) player.position.x += 0.8*dt*60;
      player.position.x = Math.max(-limit, Math.min(limit, player.position.x));
      if(keys['ArrowDown']) speed -= 80*dt; speed = Math.max(0, speed);

      for(let i=npcs.length-1;i>=0;i--){
        const npc=npcs[i]; npc.userData.z += worldMove - 8*dt; npc.position.z=npc.userData.z;
        const dz=npc.position.z - player.position.z; const dx=npc.position.x - player.position.x;
        if(dz>-2 && dz<6 && Math.abs(dx)<1.6){
          if(npc.userData.type==='oil'){ slipTimer=60; scene.remove(npc); npcs.splice(i,1); continue; }
          else{ endGame(); return; }
        }
        if(npc.position.z>40){ scene.remove(npc); npcs.splice(i,1); spawnNpc(-300 - Math.random()*300); score+=100; }
      }

      if(slipTimer>0){ slipTimer--; player.position.x += (Math.random()-0.5)*0.5; }

      score += speed*dt*0.5; scoreEl.textContent=`Pontos: ${Math.floor(score)}`;
      const elapsed=Math.floor((performance.now()-startTime)/1000); timeEl.textContent=`Tempo: ${elapsed}s`;
      const newLevel=Math.floor(elapsed/20)+1; if(newLevel!==level){ level=newLevel; levelEl.textContent=`Nível: ${level}`; }

      camera.position.x += (player.position.x - camera.position.x)*dt*3;
      camera.position.y = 15; camera.position.z = 25 - Math.min(10,speed*0.05);
      camera.lookAt(player.position.x,1.2,player.position.z-6);
    }

    function endGame(){ running=false; finalScore.textContent=`Pontuação: ${Math.floor(score)}`; gameOverScreen.style.display='flex'; }

    document.getElementById('btnRestart').addEventListener('click',()=>{ restartGame(); });
    function restartGame(){
      for(const npc of npcs) scene.remove(npc); npcs.length=0;
      for(let i=0;i<6;i++) spawnNpc(-i*40-60);
      score=0; startTime=performance.now(); level=1; speed=0; running=true;
      gameOverScreen.style.display='none'; animate();
    }

    animate();
  </script>
</body>
</html>
